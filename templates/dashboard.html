<!DOCTYPE html>
<html lang="en">
<head>
    <title>Multi Model Vineyard System</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600;700&family=Nunito+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Nunito Sans', sans-serif;
            background-image: url('https://images.unsplash.com/photo-1537640538966-79f369143f8f?q=80&w=1173&auto=format&fit=crop');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: #f4e9d8;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5));
            z-index: -1;
        }

        /* Navbar */
        .navbar-inverse {
            background: linear-gradient(to right, rgba(30, 46, 30, 0.95), rgba(60, 90, 50, 0.95));
            border: none;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
        }

        .navbar-inverse .navbar-brand, .navbar-inverse .navbar-nav > li > a {
            color: #f4e9d8;
            font-family: 'EB Garamond', serif;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        }

        .navbar-inverse .navbar-nav > li > a:hover {
            color: #ffd700;
            transform: scale(1.05);
        }

        .navbar-brand {
            font-size: 2rem;
            padding: 15px 30px;
        }

        .navbar-brand::before {
            content: 'üçá';
            margin-right: 12px;
            font-size: 1.5rem;
            animation: glow 2.5s infinite;
        }

        /* Image Upload Section */
        .image-choose {
            width: 90%;
            max-width: 600px;
            margin: 6rem auto 3rem auto;
            padding: 2.5rem;
            background: rgba(30, 30, 30, 0.4);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .image-choose h2 {
            font-family: 'EB Garamond', serif;
            color: #f4e9d8;
            font-weight: 700;
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        input[type="file"], input[type="submit"] {
            width: 100%;
            max-width: 300px;
            padding: 0.85rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border: 2px solid #ffd700;
            background-color: transparent;
            color: #f4e9d8;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="file"]:hover, input[type="submit"]:hover {
            background-color: rgba(255, 215, 0, 0.2);
            color: #1e2e1e;
        }

        /* Alert Styling */
        .alert-warning {
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            color: #f4e9d8;
            border: 1px solid #ffd700;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem auto;
            max-width: 600px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        /* Farming Dashboard */
        .dashboard {
            padding: 40px;
            text-align: center;
        }

        .dashboard h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #ffd700;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: auto;
        }

        .card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: 0.3s;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .emoji {
            font-size: 40px;
        }

        .value {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 10px;
            color: #111;
        }

        .progress-container {
            width: 100%;
            background: rgba(255,255,255,0.3);
            border-radius: 20px;
            margin-top: 15px;
            height: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            border-radius: 20px;
            transition: width 0.5s ease-in-out;
        }

        @keyframes glow {
            0% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            50% { text-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
            100% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-inverse fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand">Grapes Disease Detection</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li><a href="graph.html">Graph</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/logout"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Image Upload -->
    <div class="image-choose">
        <h2>Select Image</h2>
        <form action="{{url_for('image')}}" method="POST" style="display: flex; flex-direction: column; align-items: center;">          
            <input type="file" id="file" name="filename" required>
            <input type="submit" value="Analyse">
        </form>
    </div>

    <!-- Alert -->
    <div class="container">
        {% if msg %}
        <div class="alert alert-warning alert-dismissible">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>Warning!</strong> {{msg}}
        </div>
        {% endif %}
    </div>

    <!-- Smart Farming Dashboard -->
    <div class="dashboard">
        <h1>üå¶ Real-time Smart Farming Dashboard</h1>
        <div class="grid">
            <div class="card">
                <div class="emoji">üå°</div>
                <h2>Temperature</h2>
                <div id="temp" class="value">-- ¬∞C</div>
            </div>

            <div class="card">
                <div class="emoji">üíß</div>
                <h2>Humidity</h2>
                <div id="hum" class="value">-- %</div>
            </div>

            <div class="card">
                <div class="emoji">üå±</div>
                <h2>Soil Moisture</h2>
                <div id="soil" class="value">-- %</div>
                <div class="progress-container">
                    <div id="soilBar" class="progress-bar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script to fetch sensor data -->
    <script>
        async function fetchData() {
            try {
                let response = await fetch("/data");
                let data = await response.json();

                document.getElementById("temp").innerText = data.temperature ? data.temperature + " ¬∞C" : "-- ¬∞C";
                document.getElementById("hum").innerText = data.humidity ? data.humidity + " %" : "-- %";

                if (data.soil !== null && data.soil !== undefined) {
                    document.getElementById("soil").innerText = data.soil + " %";
                    document.getElementById("soilBar").style.width = data.soil + "%";
                } else {
                    document.getElementById("soil").innerText = "-- %";
                    document.getElementById("soilBar").style.width = "0%";
                }

            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        setInterval(fetchData, 1000); // Update every second
        fetchData();
    </script>
</body>
</html>templates\Soil_Sensor_Data_Mobile_App.mp4
https://sdmntprwestus.oaiusercontent.com/files/00000000-03b4-6230-a7b7-0defcc82b445/raw?se=2025-08-28T19%3A41%3A09Z&sp=r&sv=2024-08-04&sr=b&scid=d9b97564-c452-5a14-9c81-0f100193bf79&skoid=f71d6506-3cac-498e-b62a-67f9228033a9&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-08-27T20%3A24%3A31Z&ske=2025-08-28T20%3A24%3A31Z&sks=b&skv=2024-08-04&sig=MVfv9l3R3cF9mE9yNlyPVTp1uO9gz9qpWME1ttOlBqI%3D














import os
import cv2
import numpy as np
import pickle
import shutil
import sqlite3
import matplotlib.pyplot as plt
from flask import Flask, render_template, url_for, request, jsonify
from tensorflow.keras.preprocessing.image import load_img, img_to_array
from tensorflow.keras.models import load_model
from keras.preprocessing.image import array_to_img

# ----------------------------
# Initialize Flask app
# ----------------------------
app = Flask(__name__)

# ----------------------------
# 1Ô∏è‚É£ Sensor Data Section (NodeMCU)
# ----------------------------
data_store = {"temperature": None, "humidity": None, "soil": None}

@app.route("/data", methods=["GET", "POST"])
def data():
    if request.method == "POST":
        # ESP8266 sends data here
        data_store["temperature"] = request.form.get("temperature")
        data_store["humidity"] = request.form.get("humidity")
        data_store["soil"] = request.form.get("soil")
        print("‚úÖ Received:", data_store)
        return jsonify({"status": "success"}), 200

    elif request.method == "GET":
        # Browser requests latest data
        return jsonify(data_store)

# ----------------------------
# 2Ô∏è‚É£ User Login / Registration
# ----------------------------
@app.route('/')
def index():
    return render_template('index.html')

@app.route('/userlog', methods=['GET', 'POST'])
def userlog():
    if request.method == 'POST':
        connection = sqlite3.connect('user_data.db')
        cursor = connection.cursor()

        name = request.form['name']
        password = request.form['password']

        query = "SELECT name, password FROM user WHERE name = ? AND password = ?"
        cursor.execute(query, (name, password))  # Prevent SQL injection
        result = cursor.fetchall()

        if len(result) == 0:
            return render_template('index.html', msg='Sorry, Incorrect Credentials Provided, Try Again')
        else:
            return render_template('userlog.html')
    return render_template('index.html')

@app.route('/userreg', methods=['GET', 'POST'])
def userreg():
    if request.method == 'POST':
        connection = sqlite3.connect('user_data.db')
        cursor = connection.cursor()

        name = request.form['name']
        password = request.form['password']
        mobile = request.form['phone']
        email = request.form['email']
        
        print(name, mobile, email, password)

        command = """CREATE TABLE IF NOT EXISTS user(name TEXT, password TEXT, mobile TEXT, email TEXT)"""
        cursor.execute(command)

        cursor.execute("INSERT INTO user VALUES (?, ?, ?, ?)", (name, password, mobile, email))
        connection.commit()

        return render_template('index.html', msg='Successfully Registered')
    
    return render_template('index.html')

@app.route('/userlog.html')
def userlogg():
    return render_template('userlog.html')

# ----------------------------
# 3Ô∏è‚É£ Graph Display
# ----------------------------
@app.route('/graph.html', methods=['GET', 'POST'])
def graph():
    images = [
        'http://127.0.0.1:5000/static/accuracy_plot.png',
        'http://127.0.0.1:5000/static/loss_plot.png',
        'http://127.0.0.1:5000/static/confusion_matrix.png',
        'http://127.0.0.1:5000/static/f1-scor.jpeg'
    ]
    content = ['Accuracy Graph', 'Loss Graph', 'Confusion Matrix', 'F1-Score']
    return render_template('graph.html', images=images, content=content)

# ----------------------------
# 4Ô∏è‚É£ Grape Leaf Disease Detection
# ----------------------------
@app.route('/image', methods=['GET', 'POST'])
def image():
    if request.method == 'POST':
        # Clear static/images directory
        dirPath = "static/images"
        fileList = os.listdir(dirPath)
        for fileName in fileList:
            os.remove(os.path.join(dirPath, fileName))
        
        fileName = request.form['filename']
        dst = "static/images"
        shutil.copy(os.path.join("test", fileName), dst)
        
        # Image processing
        image = cv2.imread(os.path.join("test", fileName))
        
        # Color conversion
        gray_image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
        cv2.imwrite('static/gray.jpg', gray_image)
        
        # Apply Canny edge detection
        edges = cv2.Canny(image, 250, 254)
        cv2.imwrite('static/edges.jpg', edges)
        
        # Apply thresholding
        _, threshold2 = cv2.threshold(gray_image, 128, 255, cv2.THRESH_BINARY)
        cv2.imwrite('static/threshold.jpg', threshold2)
        
        # Apply sharpening
        kernel_sharpening = np.array([[-1, -1, -1], [-1, 9, -1], [-1, -1, -1]])
        sharpened = cv2.filter2D(image, -1, kernel_sharpening)
        cv2.imwrite('static/sharpened.jpg', sharpened)
        
        # Load model and class names
        model = load_model('mobilenet_classifier.h5')
        with open('class_names.pkl', 'rb') as f:
            class_names = pickle.load(f)
        
        path = os.path.join('static/images', fileName)

        # Preprocess input image
        def preprocess_input_image(path):
            img = load_img(path, target_size=(150, 150))
            img_array = img_to_array(img)
            img_array = np.expand_dims(img_array, axis=0)
            img_array /= 255.0  # Normalize
            return img_array

        # Make prediction
        def predict_single_image(path):
            input_image = preprocess_input_image(path)
            prediction = model.predict(input_image)
            predicted_class_index = np.argmax(prediction)
            predicted_class = class_names[predicted_class_index]
            confidence = prediction[0][predicted_class_index]
            return predicted_class, confidence 

        predicted_class, confidence = predict_single_image(path)
        
        # Remedies (English & Kannada)
        remedies = {
            'Black_rot': {
                "en": [
                    "Prune infected parts and dispose of them away from the vineyard.",
                    "Apply fungicides like Mancozeb or Copper-based sprays during the growing season.",
                    "Ensure proper airflow by maintaining spacing between vines."
                ],
                "kn": [
                    "‡≤∏‡≥ã‡≤Ç‡≤ï‡≤ø‡≤§ ‡≤≠‡≤æ‡≤ó‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤ï‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¶‡≥ç‡≤∞‡≤æ‡≤ï‡≥ç‡≤∑‡≤ø‡≤§‡≥ã‡≤ü‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤¶‡≥Ç‡≤∞‡≤µ‡≤ø‡≤°‡≤ø.",
                    "‡≤¨‡≥Ü‡≤≥‡≤µ‡≤£‡≤ø‡≤ó‡≥Ü‡≤Ø ‡≤ï‡≤æ‡≤≤‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ä‡≤ù‡≥Ü‡≤¨‡≥ç ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤§‡≤æ‡≤Æ‡≥ç‡≤∞ ‡≤Ü‡≤ß‡≤æ‡≤∞‡≤ø‡≤§ ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤£‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤¨‡≤≥‡≤∏‡≤ø.",
                    "‡≤ó‡≤æ‡≤≥‡≤ø‡≤Ø ‡≤π‡≤∞‡≤ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤ñ‡≤ö‡≤ø‡≤§‡≤™‡≤°‡≤ø‡≤∏‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤≤‡≥Å ‡≤ó‡≤ø‡≤°‡≤ó‡≤≥ ‡≤®‡≤°‡≥Å‡≤µ‡≥Ü ‡≤∏‡≥Ç‡≤ï‡≥ç‡≤§ ‡≤Ö‡≤Ç‡≤§‡≤∞‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤ï‡≤æ‡≤Ø‡≥ç‡≤¶‡≤ø‡≤∞‡≤ø‡≤∏‡≤ø."
                ],
                "label_en": "Black_rot",
                "label_kn": "‡≤ï‡≤™‡≥ç‡≤™‡≥Å ‡≤ï‡≥ä‡≤≥‡≥Ü"
            },
            'Esca_(Black_Measles)': {
                "en": [
                    "Remove and destroy affected wood during winter pruning.",
                    "Avoid water stress by ensuring proper irrigation practices.",
                    "Apply sodium arsenite sprays where permitted or consult local guidelines."
                ],
                "kn": [
                    "‡≤ö‡≤≥‡≤ø‡≤ó‡≤æ‡≤≤‡≤¶ ‡≤ï‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤ï‡≥Ü‡≤Ø ‡≤∏‡≤Æ‡≤Ø‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≥ã‡≤Ç‡≤ï‡≤ø‡≤§ ‡≤Æ‡≤∞‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å‡≤π‡≤æ‡≤ï‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤®‡≤æ‡≤∂‡≤™‡≤°‡≤ø‡≤∏‡≤ø.",
                    "‡≤∏‡≤∞‡≤ø‡≤Ø‡≤æ‡≤¶ ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤Ö‡≤≠‡≥ç‡≤Ø‡≤æ‡≤∏‡≤ó‡≤≥‡≤ø‡≤Ç‡≤¶ ‡≤®‡≥Ä‡≤∞‡≤ø‡≤® ‡≤í‡≤§‡≥ç‡≤§‡≤°‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤™‡≥ç‡≤™‡≤ø‡≤∏‡≤ø.",
                    "‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø‡≤Ø‡≤ø‡≤∞‡≥Å‡≤µ ‡≤∏‡≥ç‡≤•‡≤≥‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≥ã‡≤°‡≤ø‡≤Ø‡≤Ç ‡≤Ü‡≤∞‡≥ç‡≤∏‡≥Ü‡≤®‡≥à‡≤ü‡≥ç ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤£‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤¨‡≤≥‡≤∏‡≤ø."
                ],
                "label_en": "Esca_(Black_Measles)",
                "label_kn": "‡≤é‡≤∏‡≥ç‡≤ï‡≤æ (‡≤ï‡≤™‡≥ç‡≤™‡≥Å ‡≤ï‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å)"
            },
            'healthy': {
                "en": [
                    "Maintain regular pruning and balanced fertilization.",
                    "Provide consistent irrigation and monitor for early disease signs.",
                    "Encourage beneficial insects for natural pest control."
                ],
                "kn": [
                    "‡≤®‡≤ø‡≤Ø‡≤Æ‡≤ø‡≤§ ‡≤ï‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤ï‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≤Æ‡≤§‡≥ã‡≤≤‡≤ø‡≤§ ‡≤ó‡≥ä‡≤¨‡≥ç‡≤¨‡≤∞‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤ï‡≤æ‡≤Ø‡≥ç‡≤¶‡≤ø‡≤∞‡≤ø‡≤∏‡≤ø.",
                    "‡≤®‡≤ø‡≤∞‡≤Ç‡≤§‡≤∞ ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤í‡≤¶‡≤ó‡≤ø‡≤∏‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ü‡≤∞‡≤Ç‡≤≠‡≤ø‡≤ï ‡≤∞‡≥ã‡≤ó ‡≤≤‡≤ï‡≥ç‡≤∑‡≤£‡≤ó‡≤≥‡≤ø‡≤ó‡≤æ‡≤ó‡≤ø ‡≤Æ‡≥á‡≤≤‡≥ç‡≤µ‡≤ø‡≤ö‡≤æ‡≤∞‡≤£‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø.",
                    "‡≤®‡≥à‡≤∏‡≤∞‡≥ç‡≤ó‡≤ø‡≤ï ‡≤ï‡≥Ä‡≤ü ‡≤®‡≤ø‡≤Ø‡≤Ç‡≤§‡≥ç‡≤∞‡≤£‡≤ï‡≥ç‡≤ï‡≤æ‡≤ó‡≤ø ‡≤≤‡≤æ‡≤≠‡≤¶‡≤æ‡≤Ø‡≤ï ‡≤ï‡≥Ä‡≤ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≥ã‡≤§‡≥ç‡≤∏‡≤æ‡≤π‡≤ø‡≤∏‡≤ø."
                ],
                "label_en": "healthy",
                "label_kn": "‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü"
            },
            'Leaf_blight_(Isariopsis_Leaf_Spot)': {
                "en": [
                    "Remove and burn infected leaves to prevent spread.",
                    "Spray Bordeaux mixture or Chlorothalonil fungicides as per recommendations.",
                    "Improve vineyard hygiene by clearing fallen debris and weeds."
                ],
                "kn": [
                    "‡≤∏‡≥ã‡≤Ç‡≤ï‡≤ø‡≤§ ‡≤é‡≤≤‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥Ü‡≤ó‡≥Ü‡≤¶‡≥Å‡≤π‡≤æ‡≤ï‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤í‡≤°‡≥ç‡≤°‡≥Å‡≤µ‡≤ø‡≤ï‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤°‡≥Ü‡≤ó‡≤ü‡≥ç‡≤ü‡≤≤‡≥Å ‡≤∏‡≥Å‡≤°‡≤ø.",
                    "‡≤ï‡≥É‡≤∑‡≤ø ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤Ö‡≤®‡≥Å‡≤ó‡≥Å‡≤£‡≤µ‡≤æ‡≤ó‡≤ø ‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ä ‡≤Æ‡≤ø‡≤∂‡≥ç‡≤∞‡≤£ ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤ï‡≥ç‡≤≤‡≥ã‡≤∞‡≥ã‡≤•‡≤≤‡≥ã‡≤®‡≤ø‡≤≤‡≥ç ‡≤∏‡≤ø‡≤Ç‡≤™‡≤°‡≤ø‡≤∏‡≤ø.",
                    "‡≤¨‡≤ø‡≤¶‡≥ç‡≤¶‡≤ø‡≤∞‡≥Å‡≤µ ‡≤∂‡≤ø‡≤≤‡≤æ‡≤ñ‡≤Ç‡≤°‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤ï‡≤≥‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≥Ü‡≤∞‡≤µ‡≥Å‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≤ø."
                ],
                "label_en": "Leaf_blight_(Isariopsis_Leaf_Spot)",
                "label_kn": "‡≤é‡≤≤‡≥Ü‡≤Ø ‡≤ï‡≥ä‡≤≥‡≥Ü (‡≤á‡≤∏‡≤æ‡≤∞‡≤ø‡≤Ø‡≥ã‡≤™‡≥ç‡≤∏‡≤ø‡≤∏‡≥ç ‡≤é‡≤≤‡≥Ü‡≤Ø ‡≤ï‡≤≤‡≥Ü)"
            }
        }

        if predicted_class in remedies:
            r = remedies[predicted_class]
            str_label, str_label_kannada = r["label_en"], r["label_kn"]
            rem, rem1, rem_kannada, rem1_kannada = "Remedies for Grape Leaves", r["en"], "‡≤¶‡≥ç‡≤∞‡≤æ‡≤ï‡≥ç‡≤∑‡≤ø‡≤Ø ‡≤é‡≤≤‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤™‡≤∞‡≤ø‡≤π‡≤æ‡≤∞‡≤ó‡≤≥‡≥Å", r["kn"]
        else:
            str_label, str_label_kannada = predicted_class, predicted_class
            rem, rem1, rem_kannada, rem1_kannada = "No Remedies Found", [], "‡≤™‡≤∞‡≤ø‡≤π‡≤æ‡≤∞ ‡≤∏‡≤ø‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤", []

        accuracy = f"The predicted image is {str_label} with a confidence of {confidence:.2%}"
        accuracy_kannada = f"‡≤™‡≥ç‡≤∞‡≤ø‡≤°‡≤ø‡≤ï‡≥ç‡≤ü‡≥Ü‡≤°‡≥ç ‡≤ö‡≤ø‡≤§‡≥ç‡≤∞‡≤µ‡≥Å {str_label_kannada} ‡≤Ü‡≤ó‡≤ø‡≤¶‡≥Ü, ‡≤µ‡≤ø‡≤∂‡≥ç‡≤µ‡≤æ‡≤∏‡≤¶ ‡≤Æ‡≤ü‡≥ç‡≤ü {confidence:.2%}"

        return render_template(
            'results.html',
            status=str_label,
            accuracy=accuracy,
            Remedies=rem,
            Remedies1=rem1,
            status_kannada=str_label_kannada,
            accuracy_kannada=accuracy_kannada,
            Remedies_kannada=rem_kannada,
            Remedies1_kannada=rem1_kannada,
            ImageDisplay=f"http://127.0.0.1:5000/static/images/{fileName}",
            ImageDisplay1="http://127.0.0.1:5000/static/gray.jpg",
            ImageDisplay2="http://127.0.0.1:5000/static/edges.jpg",
            ImageDisplay3="http://127.0.0.1:5000/static/threshold.jpg",
            ImageDisplay4="http://127.0.0.1:5000/static/sharpened.jpg"
        )
    
    return render_template('userlog.html')

# ----------------------------
# Logout
# ----------------------------
@app.route('/logout')
def logout():
    return render_template('index.html')


# ----------------------------
# Run App
# ----------------------------
if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)

